# Maintainer: Denis Benato <benato.denis96@gmail.com>

pkgname=chimeraos-dracut-cfg
pkgver=0.0.1
pkgrel=1
pkgdesc="Dracut-specific configuration for chimeraos"
arch=('any')
url="https://github.com/ChimeraOS/chimeraos"
license=('MIT')
depends=(
    'dracut' # regenerate the initramfs
    'plymouth' # support for boot animations
    'binutils' # allow usage of --strip
)
source=(
    "dracut-install.sh"
    "dracut-remove.sh"
    "00-chimeraos.conf"
    "10-chimeraos_use-fstab.conf"
    "20-chimeraos_include-plymouth.conf"
    "30-chimeraos_include-filesystems.conf"
    "40-chimeraos_exclude-encryption.conf"
    "50-chimeraos_exclude-mdraid.conf"
    "60-chimeraos_exclude-networking.conf"
    "70-chimeraos_exclude-nvdimm.conf"
    "80-chimeraos_exclude-qemu.conf"
    "90-chimeraos_exclude-bluetooth.conf"
    "60-dracut-remove.hook"
    "90-dracut-install.hook"
)
sha256sums=(
    '17cdd42abda651deaf773a264b8a1cd2b5e5fa66b4e9705a42ab3733c941e227' # dracut-install.sh
    'daefb58a0bf6df48cceaf4f7a898c17ca1f24e18cd7981b19f5f2034499592ed' # dracut-remove.sh
    'e6558e94eaac394e8147cb6c6324bad3fe486f5db5055a6a26d5123fd498620f' # 00-chimeraos.conf
    '7886062a7293d2e6bd6e975c4a8aaae63342af366479db8adf1b75860081cf53' # 10-chimeraos_use-fstab.conf
    '200e84e62b015d188ab2be413a0551f38c8939cfdd27e0cb91a22e214bf1a5ab' # 20-chimeraos_include-plymouth.conf
    '7f7c86119fee39e9b5e29fa25fb16ec09c8df92b851e74a4ccd6edd3c277b67b' # 30-chimeraos_include-filesystems.conf
    '8b4247161bb9158bf382517bb061360c184315e71fea244420d8db99d2730129' # 40-chimeraos_exclude-encryption.conf
    '84cccef9706590795b37b4d949c0a34e6ee7ba34ee7ff01a8c808a2fe3ff7f89' # 50-chimeraos_exclude-mdraid.conf
    '3a5767d2ad8bb59518025f5d5767cd0a0ca05b4dd500fce7f9d79a3bf27b9a4a' # 60-chimeraos_exclude-networking.conf
    '5822aa5a698577937820ab2565a203492b6af81434bf1423664ef68bba8c1617' # 70-chimeraos_exclude-nvdimm.conf
    'b126149ca9f79bb1deb7ec640f4452dd61f4214558f954b7bc9196c5e9ca6ef0' # 80-chimeraos_exclude-qemu.conf
    'e983493fe3e7d9395dd8d1c8949150144c8d4318ff17ff2aca004235734c8299' # 90-chimeraos_exclude-bluetooth.conf
    '41c996bf7ef90e6a81690c4a06cbef89167882a036699834fe22637a1a184982' # 60-dracut-remove.hook
    'df94baaf97d110f65f1443dd7063fe0e8ec1f73b5baf142c6ff08c260e571fcb' # 90-dracut-install.hook
)

package() {
    mkdir -p "$pkgdir/etc/dracut.conf.d/"
    mkdir -p "$pkgdir/usr/local/bin/"
    mkdir -p "$pkgdir/usr/share/libalpm/hooks"
    
    install -m 755 "$srcdir/dracut-install.sh" "$pkgdir/usr/local/bin"
    install -m 755 "$srcdir/dracut-remove.sh" "$pkgdir/usr/local/bin"

    install -m 644 "$srcdir/60-dracut-remove.hook" "$pkgdir/usr/share/libalpm/hooks"
    install -m 644 "$srcdir/90-dracut-install.hook" "$pkgdir/usr/share/libalpm/hooks"

    install -m 644 "$srcdir/00-chimeraos.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/10-chimeraos_use-fstab.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/20-chimeraos_include-plymouth.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/30-chimeraos_include-filesystems.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/40-chimeraos_exclude-encryption.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/50-chimeraos_exclude-mdraid.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/60-chimeraos_exclude-networking.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/70-chimeraos_exclude-nvdimm.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/80-chimeraos_exclude-qemu.conf" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "90-chimeraos_exclude-bluetooth.conf" "$pkgdir/etc/dracut.conf.d"

    install -m 644 "$srcdir/60-dracut-remove.hook" "$pkgdir/etc/dracut.conf.d"
    install -m 644 "$srcdir/90-dracut-install.hook" "$pkgdir/etc/dracut.conf.d"
}

